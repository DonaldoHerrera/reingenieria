package defpackage;

import com.facebook.stetho.server.http.HttpStatus;
import com.soundcloud.android.foundation.events.C3700b;
import com.soundcloud.android.foundation.events.J;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashSet;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map.Entry;
import java.util.Set;

@EVa(d1 = {"\u0000N\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\f\n\u0002\u0010 \n\u0002\u0018\u0002\n\u0002\b\u0005\n\u0002\u0010\"\n\u0002\b\u0002\n\u0002\u0010\t\n\u0002\b\u000e\n\u0002\u0010\u0002\n\u0002\b\u0003\b\u0016\u0018\u0000 32\u00020\u0001:\u00013B/\b\u0007\u0012\u0006\u0010\u0002\u001a\u00020\u0003\u0012\u0006\u0010\u0004\u001a\u00020\u0005\u0012\u0006\u0010\u0006\u001a\u00020\u0007\u0012\u0006\u0010\b\u001a\u00020\t\u0012\u0006\u0010\n\u001a\u00020\u000b¢\u0006\u0002\u0010\fJ\u000e\u0010\u0017\u001a\b\u0012\u0004\u0012\u00020\u00190\u0018H\u0012J\u000e\u0010\u001a\u001a\b\u0012\u0004\u0012\u00020\u00190\u0018H\u0012J\u000e\u0010\u001b\u001a\b\u0012\u0004\u0012\u00020\u00190\u0018H\u0012J\u000e\u0010\u001c\u001a\b\u0012\u0004\u0012\u00020\u00190\u0018H\u0012J\u001c\u0010\u001d\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010\u001e\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010 \u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010!\u001a\b\u0012\u0004\u0012\u00020\"0\u0018H\u0012J\u001c\u0010#\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010$\u001a\b\u0012\u0004\u0012\u00020\"0\u0018H\u0012J\u001c\u0010%\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010&\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010'\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010\u001e\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010(\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010)\u001a\b\u0012\u0004\u0012\u00020\"0\u0018H\u0012J\u001c\u0010*\u001a\b\u0012\u0004\u0012\u00020\u00190\u001f2\f\u0010&\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010+\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010\u001e\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010,\u001a\b\u0012\u0004\u0012\u00020\u00190\u001f2\f\u0010&\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010-\u001a\b\u0012\u0004\u0012\u00020\u00190\u001f2\f\u0010\u001e\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\u001c\u0010.\u001a\b\u0012\u0004\u0012\u00020\u00190\u00182\f\u0010/\u001a\b\u0012\u0004\u0012\u00020\u00190\u001fH\u0012J\b\u00100\u001a\u000201H\u0016J\u0018\u00102\u001a\b\u0012\u0004\u0012\u00020\"0\u0018*\b\u0012\u0004\u0012\u00020\u00190\u0018H\u0012R\u0014\u0010\b\u001a\u00020\tX\u0004¢\u0006\b\n\u0000\u001a\u0004\b\r\u0010\u000eR\u0014\u0010\n\u001a\u00020\u000bX\u0004¢\u0006\b\n\u0000\u001a\u0004\b\u000f\u0010\u0010R\u0014\u0010\u0006\u001a\u00020\u0007X\u0004¢\u0006\b\n\u0000\u001a\u0004\b\u0011\u0010\u0012R\u0014\u0010\u0004\u001a\u00020\u0005X\u0004¢\u0006\b\n\u0000\u001a\u0004\b\u0013\u0010\u0014R\u0014\u0010\u0002\u001a\u00020\u0003X\u0004¢\u0006\b\n\u0000\u001a\u0004\b\u0015\u0010\u0016¨\u00064"}, d2 = {"Lcom/soundcloud/android/storage/DatabaseCleanupController;", "", "propellerDatabase", "Lcom/soundcloud/propeller/PropellerDatabase;", "mediaStreamsStorage", "Lcom/soundcloud/android/tracks/mediastreams/MediaStreamsStorage;", "eventBus", "Lcom/soundcloud/rx/eventbus/EventBus;", "analytics", "Lcom/soundcloud/android/foundation/events/Analytics;", "cleanupHelpersHolder", "Lcom/soundcloud/android/storage/CleanupHelpersHolder;", "(Lcom/soundcloud/propeller/PropellerDatabase;Lcom/soundcloud/android/tracks/mediastreams/MediaStreamsStorage;Lcom/soundcloud/rx/eventbus/EventBus;Lcom/soundcloud/android/foundation/events/Analytics;Lcom/soundcloud/android/storage/CleanupHelpersHolder;)V", "getAnalytics", "()Lcom/soundcloud/android/foundation/events/Analytics;", "getCleanupHelpersHolder", "()Lcom/soundcloud/android/storage/CleanupHelpersHolder;", "getEventBus", "()Lcom/soundcloud/rx/eventbus/EventBus;", "getMediaStreamsStorage", "()Lcom/soundcloud/android/tracks/mediastreams/MediaStreamsStorage;", "getPropellerDatabase", "()Lcom/soundcloud/propeller/PropellerDatabase;", "getAllPlaylistsFromDB", "", "Lcom/soundcloud/android/foundation/domain/Urn;", "getAllTrackPoliciesFromDB", "getAllTracksFromDB", "getAllUserFromDB", "getMediaStreamsToDelete", "tracksToKeep", "", "getPlaylistTracksById", "ids", "", "getPlaylistUserUrns", "playlistIds", "getPlaylistsToDelete", "playlistsToKeep", "getTrackPoliciesToDelete", "getTrackUsersUrns", "trackIds", "getTracksForPlaylists", "getTracksToDelete", "getUsersForPlaylist", "getUsersForTrack", "getUsersToDelete", "usersToKeep", "performCleanup", "", "toNumericIds", "Companion", "base_release"}, mv = {1, 1, 15})
/* renamed from: bya reason: default package and case insensitive filesystem */
/* compiled from: DatabaseCleanupController.kt */
public class C5680bya {
    public static final a a = new a(null);
    private final C5500ZKa b;
    private final C4797CDa c;
    private final C5327TLa d;
    private final C3700b e;
    private final C5612aya f;

    /* renamed from: bya$a */
    /* compiled from: DatabaseCleanupController.kt */
    public static final class a {
        private a() {
        }

        public /* synthetic */ a(C7264rYa rya) {
            this();
        }
    }

    public C5680bya(C5500ZKa zKa, C4797CDa cDa, C5327TLa tLa, C3700b bVar, C5612aya aya) {
        C7471uYa.b(zKa, "propellerDatabase");
        C7471uYa.b(cDa, "mediaStreamsStorage");
        C7471uYa.b(tLa, "eventBus");
        C7471uYa.b(bVar, "analytics");
        C7471uYa.b(aya, "cleanupHelpersHolder");
        this.b = zKa;
        this.c = cDa;
        this.d = tLa;
        this.e = bVar;
        this.f = aya;
    }

    private List<C3508cda> f() {
        List<C3508cda> b2 = d().a((C6975nLa) C6975nLa.a(e.c).a(e.d).a(e.e, (Object) Integer.valueOf(1))).b(C6276cya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…sorReader.getLong(_ID)) }");
        return b2;
    }

    private List<C3508cda> g() {
        List<C3508cda> b2 = d().a(C6975nLa.a(f.c).a(f.d)).b(C6344dya.a);
        C7471uYa.a((Object) b2, "result.toList { cursorRe…rackPolicies.TRACK_ID)) }");
        return b2;
    }

    private List<C3508cda> h(Set<C3508cda> set) {
        return C7676xWa.c((Iterable) i(), (Iterable) set);
    }

    private List<C3508cda> i() {
        List<C3508cda> b2 = d().a(C6975nLa.a(h.c).a(h.d)).b(C6480fya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…Long(Tables.Users._ID)) }");
        return b2;
    }

    public C5612aya b() {
        return this.f;
    }

    public C4797CDa c() {
        return this.c;
    }

    public C5500ZKa d() {
        return this.b;
    }

    public void e() {
        LinkedHashMap linkedHashMap = new LinkedHashMap();
        LinkedHashMap linkedHashMap2 = new LinkedHashMap();
        LinkedHashMap linkedHashMap3 = new LinkedHashMap();
        for (Wda wda : b().a()) {
            linkedHashMap.put(wda.getKey(), wda.a());
            linkedHashMap2.put(wda.getKey(), wda.c());
            linkedHashMap3.put(wda.getKey(), wda.b());
        }
        Collection<Set> values = linkedHashMap.values();
        Set hashSet = new HashSet();
        for (Set b2 : values) {
            hashSet = TWa.b(hashSet, (Iterable<? extends T>) b2);
        }
        Set s = C7676xWa.s(hashSet);
        Collection<Set> values2 = linkedHashMap2.values();
        Set hashSet2 = new HashSet();
        for (Set b3 : values2) {
            hashSet2 = TWa.b(hashSet2, (Iterable<? extends T>) b3);
        }
        Set s2 = C7676xWa.s(hashSet2);
        Collection<Set> values3 = linkedHashMap3.values();
        Set hashSet3 = new HashSet();
        for (Set b4 : values3) {
            hashSet3 = TWa.b(hashSet3, (Iterable<? extends T>) b4);
        }
        Set s3 = C7676xWa.s(hashSet3);
        s2.addAll(d(s3));
        s.addAll(g(s2));
        s.addAll(f(s3));
        List b5 = b(s3);
        List e2 = e(s2);
        List c2 = c(s2);
        List a2 = a(s2);
        List h = h(s);
        C5500ZKa d2 = d();
        C6752jya jya = new C6752jya(this, b5, e2, c2, a2, h);
        C6431fLa a3 = d2.a((defpackage.C5500ZKa.a) jya);
        int size = h.size();
        int size2 = e2.size();
        int size3 = b5.size();
        LinkedHashMap linkedHashMap4 = new LinkedHashMap(LWa.a(linkedHashMap.size()));
        for (Entry entry : linkedHashMap.entrySet()) {
            linkedHashMap4.put(entry.getKey(), Integer.valueOf(((Set) entry.getValue()).size()));
        }
        LinkedHashMap linkedHashMap5 = new LinkedHashMap(LWa.a(linkedHashMap2.size()));
        for (Entry entry2 : linkedHashMap2.entrySet()) {
            linkedHashMap5.put(entry2.getKey(), Integer.valueOf(((Set) entry2.getValue()).size()));
        }
        LinkedHashMap linkedHashMap6 = new LinkedHashMap(LWa.a(linkedHashMap3.size()));
        for (Entry entry3 : linkedHashMap3.entrySet()) {
            linkedHashMap6.put(entry3.getKey(), Integer.valueOf(((Set) entry3.getValue()).size()));
        }
        C7784yya a4 = C7784yya.a(size, size2, size3, linkedHashMap4, linkedHashMap5, linkedHashMap6);
        if (a3.b()) {
            C3700b a5 = a();
            C7471uYa.a((Object) a4, "storageCleanupEvent");
            a5.a((J) a4);
            return;
        }
        StringBuilder sb = new StringBuilder();
        sb.append("Could not cleanup database ");
        sb.append(a4);
        C7316sHa.d(new IllegalStateException(sb.toString()));
    }

    private List<C3508cda> b(Set<C3508cda> set) {
        return C7676xWa.c((Iterable) f(), (Iterable) set);
    }

    private List<C3508cda> c(Set<C3508cda> set) {
        return C7676xWa.c((Iterable) g(), (Iterable) set);
    }

    private Set<C3508cda> d(Set<C3508cda> set) {
        List<List> b2 = C7676xWa.b((Iterable) set, (int) HttpStatus.HTTP_INTERNAL_SERVER_ERROR);
        ArrayList<List> arrayList = new ArrayList<>(C6986nWa.a((Iterable<? extends T>) b2, 10));
        for (List d2 : b2) {
            arrayList.add(d(d2));
        }
        ArrayList arrayList2 = new ArrayList();
        for (List a2 : arrayList) {
            C7331sWa.a((Collection) arrayList2, (Iterable) a(a2));
        }
        return C7676xWa.t(arrayList2);
    }

    private List<C3508cda> h() {
        List<C3508cda> b2 = d().a((C6975nLa) C6975nLa.a(e.c).a(e.d).a(e.e, (Object) Integer.valueOf(0))).b(C6412eya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…sorReader.getLong(_ID)) }");
        return b2;
    }

    public C3700b a() {
        return this.e;
    }

    private List<C3508cda> a(Set<C3508cda> set) {
        return C7676xWa.c((Iterable) c().b(), (Iterable) set);
    }

    private List<C3508cda> b(List<Long> list) {
        List<C3508cda> b2 = d().a((C6975nLa) ((C6975nLa) C6975nLa.a(e.c).a(e.H).a(e.e, (Object) Integer.valueOf(1))).a(e.d, (Collection<?>) list)).b(C6616hya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…eader.getLong(USER_ID)) }");
        return b2;
    }

    private List<C3508cda> c(List<Long> list) {
        List<C3508cda> b2 = d().a((C6975nLa) ((C6975nLa) C6975nLa.a(e.c).a(e.H).a(e.e, (Object) Integer.valueOf(0))).a(e.d, (Collection<?>) list)).b(C6684iya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…eader.getLong(USER_ID)) }");
        return b2;
    }

    private Set<C3508cda> f(Set<C3508cda> set) {
        List<List> b2 = C7676xWa.b((Iterable) set, (int) HttpStatus.HTTP_INTERNAL_SERVER_ERROR);
        ArrayList<List> arrayList = new ArrayList<>(C6986nWa.a((Iterable<? extends T>) b2, 10));
        for (List d2 : b2) {
            arrayList.add(d(d2));
        }
        ArrayList arrayList2 = new ArrayList();
        for (List b3 : arrayList) {
            C7331sWa.a((Collection) arrayList2, (Iterable) b(b3));
        }
        return C7676xWa.t(arrayList2);
    }

    private Set<C3508cda> g(Set<C3508cda> set) {
        List<List> b2 = C7676xWa.b((Iterable) set, (int) HttpStatus.HTTP_INTERNAL_SERVER_ERROR);
        ArrayList<List> arrayList = new ArrayList<>(C6986nWa.a((Iterable<? extends T>) b2, 10));
        for (List d2 : b2) {
            arrayList.add(d(d2));
        }
        ArrayList arrayList2 = new ArrayList();
        for (List c2 : arrayList) {
            C7331sWa.a((Collection) arrayList2, (Iterable) c(c2));
        }
        return C7676xWa.t(arrayList2);
    }

    private List<C3508cda> a(List<Long> list) {
        List<C3508cda> b2 = d().a((C6975nLa) C6975nLa.a(_ea.PlaylistTracks).a("track_id").b("playlist_id", (Collection<?>) list)).b(C6548gya.a);
        C7471uYa.a((Object) b2, "propellerDatabase.query(…ader.getLong(TRACK_ID)) }");
        return b2;
    }

    /* access modifiers changed from: private */
    public List<Long> d(List<C3508cda> list) {
        ArrayList arrayList = new ArrayList(C6986nWa.a((Iterable<? extends T>) list, 10));
        for (C3508cda c2 : list) {
            arrayList.add(Long.valueOf(c2.c()));
        }
        return arrayList;
    }

    private List<C3508cda> e(Set<C3508cda> set) {
        return C7676xWa.c((Iterable) h(), (Iterable) set);
    }
}
