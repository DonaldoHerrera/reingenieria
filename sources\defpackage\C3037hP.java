package defpackage;

import com.soundcloud.android.accounts.C2526g;
import com.soundcloud.android.ads.C2594la;
import com.soundcloud.android.properties.j;
import com.soundcloud.android.utilities.android.m;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.nio.charset.Charset;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

@EVa(d1 = {"\u0000¸\u0001\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u000b\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u000e\n\u0002\b\u0004\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0003\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0002\b\u0002\n\u0002\u0010\t\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0002\b\t\n\u0002\u0018\u0002\n\u0002\b\u0002\b\u0016\u0018\u0000 G2\u00020\u0001:\u0001GBy\b\u0000\u0012\f\u0010\u0002\u001a\b\u0012\u0004\u0012\u00020\u00040\u0003\u0012\f\u0010\u0005\u001a\b\u0012\u0004\u0012\u00020\u00070\u0006\u0012\f\u0010\b\u001a\b\u0012\u0004\u0012\u00020\t0\u0003\u0012\u0006\u0010\n\u001a\u00020\u000b\u0012\u0006\u0010\f\u001a\u00020\r\u0012\u0006\u0010\u000e\u001a\u00020\u000f\u0012\u0006\u0010\u0010\u001a\u00020\u0011\u0012\u0006\u0010\u0012\u001a\u00020\u0013\u0012\u0006\u0010\u0014\u001a\u00020\u0015\u0012\u0006\u0010\u0016\u001a\u00020\u0017\u0012\u0006\u0010\u0018\u001a\u00020\u0019\u0012\u0006\u0010\u001a\u001a\u00020\u001b¢\u0006\u0002\u0010\u001cJ\u0010\u0010\"\u001a\u00020#2\u0006\u0010$\u001a\u00020%H\u0012J)\u0010&\u001a\u0002H'\"\u0004\b\u0000\u0010'2\u0006\u0010$\u001a\u00020%2\f\u0010(\u001a\b\u0012\u0004\u0012\u0002H'0)H\u0016¢\u0006\u0002\u0010*J)\u0010&\u001a\u0002H'\"\u0004\b\u0000\u0010'2\u0006\u0010$\u001a\u00020%2\f\u0010(\u001a\b\u0012\u0004\u0012\u0002H'0+H\u0016¢\u0006\u0002\u0010,J\u0010\u0010-\u001a\u00020.2\u0006\u0010$\u001a\u00020%H\u0016J\u0010\u0010/\u001a\u0002002\u0006\u0010$\u001a\u000201H\u0012J\u0010\u00102\u001a\u0002002\u0006\u0010$\u001a\u000203H\u0012J\u0010\u00104\u001a\u0002002\u0006\u0010$\u001a\u00020%H\u0012J\u0010\u00105\u001a\u0002062\u0006\u0010$\u001a\u00020#H\u0012J\u0018\u00107\u001a\u0002062\u0006\u0010$\u001a\u00020#2\u0006\u00108\u001a\u000209H\u0012J\u0010\u0010:\u001a\u0002062\u0006\u0010;\u001a\u00020<H\u0012J)\u0010=\u001a\u0002H>\"\u0004\b\u0000\u0010>2\u0006\u0010?\u001a\u00020.2\f\u0010@\u001a\b\u0012\u0004\u0012\u0002H>0)H\u0016¢\u0006\u0002\u0010AJ)\u0010B\u001a\u0002H>\"\u0004\b\u0000\u0010>2\u0006\u0010?\u001a\u00020.2\f\u0010@\u001a\b\u0012\u0004\u0012\u0002H>0)H\u0012¢\u0006\u0002\u0010AJ\u0010\u0010C\u001a\u0002062\u0006\u0010!\u001a\u00020\u0017H\u0016J\u0018\u0010D\u001a\u0002062\u0006\u0010$\u001a\u00020%2\u0006\u0010E\u001a\u00020FH\u0012R\u000e\u0010\u0012\u001a\u00020\u0013X\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\f\u001a\u00020\rX\u0004¢\u0006\u0002\n\u0000R\u0014\u0010\u001d\u001a\u00020\u001e8RX\u0004¢\u0006\u0006\u001a\u0004\b\u001f\u0010 R\u000e\u0010\u001a\u001a\u00020\u001bX\u0004¢\u0006\u0002\n\u0000R\u000e\u0010!\u001a\u00020\u0017X\u000e¢\u0006\u0002\n\u0000R\u000e\u0010\n\u001a\u00020\u000bX\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\u0018\u001a\u00020\u0019X\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\u0016\u001a\u00020\u0017X\u0004¢\u0006\u0002\n\u0000R\u0014\u0010\u0002\u001a\b\u0012\u0004\u0012\u00020\u00040\u0003X\u0004¢\u0006\u0002\n\u0000R\u0014\u0010\b\u001a\b\u0012\u0004\u0012\u00020\t0\u0003X\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\u0014\u001a\u00020\u0015X\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\u000e\u001a\u00020\u000fX\u0004¢\u0006\u0002\n\u0000R\u000e\u0010\u0010\u001a\u00020\u0011X\u0004¢\u0006\u0002\n\u0000R\u0014\u0010\u0005\u001a\b\u0012\u0004\u0012\u00020\u00070\u0006X\u0004¢\u0006\u0002\n\u0000¨\u0006H"}, d2 = {"Lcom/soundcloud/android/api/DefaultApiClient;", "Lcom/soundcloud/android/libs/api/ApiClient;", "httpClientLazy", "Ldagger/Lazy;", "Lokhttp3/OkHttpClient;", "urlBuilder", "Ljavax/inject/Provider;", "Lcom/soundcloud/android/api/ApiUrlBuilder;", "jsonTransformerLazy", "Lcom/soundcloud/android/json/JsonTransformer;", "deviceHelper", "Lcom/soundcloud/android/utils/DeviceHelper;", "adIdHelper", "Lcom/soundcloud/android/ads/AdIdHelper;", "oAuth", "Lcom/soundcloud/android/api/oauth/OAuth;", "unauthorisedRequestRegistry", "Lcom/soundcloud/android/api/UnauthorisedRequestRegistry;", "accountOperations", "Lcom/soundcloud/android/accounts/AccountOperations;", "localeFormatter", "Lcom/soundcloud/android/utils/LocaleFormatter;", "failFastOnMapper", "", "experimentOperations", "Lcom/soundcloud/android/configuration/experiments/ExperimentOperations;", "appFeatures", "Lcom/soundcloud/android/properties/AppFeatures;", "(Ldagger/Lazy;Ljavax/inject/Provider;Ldagger/Lazy;Lcom/soundcloud/android/utils/DeviceHelper;Lcom/soundcloud/android/ads/AdIdHelper;Lcom/soundcloud/android/api/oauth/OAuth;Lcom/soundcloud/android/api/UnauthorisedRequestRegistry;Lcom/soundcloud/android/accounts/AccountOperations;Lcom/soundcloud/android/utils/LocaleFormatter;ZLcom/soundcloud/android/configuration/experiments/ExperimentOperations;Lcom/soundcloud/android/properties/AppFeatures;)V", "appEnvironment", "", "getAppEnvironment", "()Ljava/lang/String;", "assertBackgroundThread", "buildRequest", "Lokhttp3/Request;", "request", "Lcom/soundcloud/android/libs/api/ApiRequest;", "fetchMappedResponse", "ResourceType", "resourceType", "Lcom/soundcloud/java/reflect/TypeToken;", "(Lcom/soundcloud/android/libs/api/ApiRequest;Lcom/soundcloud/java/reflect/TypeToken;)Ljava/lang/Object;", "Ljava/lang/Class;", "(Lcom/soundcloud/android/libs/api/ApiRequest;Ljava/lang/Class;)Ljava/lang/Object;", "fetchResponse", "Lcom/soundcloud/android/libs/api/ApiResponse;", "getJsonRequestBody", "Lokhttp3/RequestBody;", "Lcom/soundcloud/android/libs/api/ApiObjectContentRequest;", "getMultipartRequestBody", "Lcom/soundcloud/android/libs/api/ApiMultipartRequest;", "getRequestBody", "logRequest", "", "logRequestCompleted", "elapsedTime", "", "logResponse", "response", "Lokhttp3/Response;", "mapResponse", "T", "apiResponse", "typeToken", "(Lcom/soundcloud/android/libs/api/ApiResponse;Lcom/soundcloud/java/reflect/TypeToken;)Ljava/lang/Object;", "parseJsonResponse", "setAssertBackgroundThread", "setHttpHeaders", "builder", "Lokhttp3/Request$Builder;", "Companion", "base_release"}, mv = {1, 1, 15})
/* renamed from: hP reason: default package and case insensitive filesystem */
/* compiled from: DefaultApiClient.kt */
public class C3037hP implements dfa {
    public static final a a = new a(null);
    private boolean b;
    private final C4806CMa<C7440tyb> c;
    private final C7054oVa<C2961dP> d;
    private final C4806CMa<Nea> e;
    private final C6699jHa f;
    private final C2594la g;
    private final C2322UP h;
    private final C3218qP i;
    private final C2526g j;
    private final C5018JHa k;
    private final boolean l;
    private final C2137KU m;
    private final com.soundcloud.android.properties.a n;

    /* renamed from: hP$a */
    /* compiled from: DefaultApiClient.kt */
    public static final class a {
        private a() {
        }

        public /* synthetic */ a(C7264rYa rya) {
            this();
        }
    }

    public C3037hP(C4806CMa<C7440tyb> cMa, C7054oVa<C2961dP> ova, C4806CMa<Nea> cMa2, C6699jHa jha, C2594la laVar, C2322UP up, C3218qP qPVar, C2526g gVar, C5018JHa jHa, boolean z, C2137KU ku, com.soundcloud.android.properties.a aVar) {
        C7471uYa.b(cMa, "httpClientLazy");
        C7471uYa.b(ova, "urlBuilder");
        C7471uYa.b(cMa2, "jsonTransformerLazy");
        C7471uYa.b(jha, "deviceHelper");
        C7471uYa.b(laVar, "adIdHelper");
        C7471uYa.b(up, "oAuth");
        C7471uYa.b(qPVar, "unauthorisedRequestRegistry");
        C7471uYa.b(gVar, "accountOperations");
        C7471uYa.b(jHa, "localeFormatter");
        C7471uYa.b(ku, "experimentOperations");
        C7471uYa.b(aVar, "appFeatures");
        this.c = cMa;
        this.d = ova;
        this.e = cMa2;
        this.f = jha;
        this.g = laVar;
        this.h = up;
        this.i = qPVar;
        this.j = gVar;
        this.k = jHa;
        this.l = z;
        this.m = ku;
        this.n = aVar;
    }

    private String a() {
        String str = "prod";
        if (new C7162pxb("(dev|alpha|beta|prod)").b(str)) {
            return str;
        }
        throw new IllegalStateException("App-Environment is not one of dev, alpha, beta or prod");
    }

    /* JADX WARNING: Code restructure failed: missing block: B:16:0x0068, code lost:
        r4 = r0.a();
        defpackage.C7471uYa.a((java.lang.Object) r4, "with(Request.Builder()) …      }\n        }.build()");
     */
    /* JADX WARNING: Code restructure failed: missing block: B:17:0x0071, code lost:
        return r4;
     */
    private C7647wyb b(hfa hfa) {
        defpackage.C7647wyb.a aVar = new defpackage.C7647wyb.a();
        aVar.b(((C2961dP) this.d.get()).a(hfa).a(hfa.e()).a());
        a(hfa, aVar);
        String d2 = hfa.d();
        if (d2 != null) {
            switch (d2.hashCode()) {
                case 70454:
                    if (d2.equals("GET")) {
                        aVar.c();
                        break;
                    }
                    break;
                case 79599:
                    if (d2.equals("PUT")) {
                        aVar.c(c(hfa));
                        break;
                    }
                    break;
                case 2461856:
                    if (d2.equals("POST")) {
                        aVar.b(c(hfa));
                        break;
                    }
                    break;
                case 2012838315:
                    if (d2.equals("DELETE")) {
                        aVar.b();
                        break;
                    }
                    break;
            }
        }
        StringBuilder sb = new StringBuilder();
        sb.append("Unsupported HTTP method: ");
        sb.append(hfa.d());
        throw new IllegalArgumentException(sb.toString());
    }

    private C7854zyb c(hfa hfa) throws Lea, UnsupportedEncodingException {
        if (hfa instanceof gfa) {
            return a((gfa) hfa);
        }
        if (hfa instanceof ffa) {
            return a((ffa) hfa);
        }
        C7854zyb a2 = C7854zyb.a(C7233qyb.b(hfa.b()), "");
        C7471uYa.a((Object) a2, "RequestBody.create(\n    …rings.EMPTY\n            )");
        return a2;
    }

    public void a(boolean z) {
        this.b = z;
    }

    public jfa a(hfa hfa) {
        C7471uYa.b(hfa, "request");
        if (this.b) {
            m.a("Detected execution of API request on main thread");
        }
        try {
            long currentTimeMillis = System.currentTimeMillis();
            C7647wyb b2 = b(hfa);
            a(b2);
            Ayb execute = ((C7440tyb) this.c.get()).a(b2).execute();
            a(b2, System.currentTimeMillis() - currentTimeMillis);
            if (execute.d() == 401 && this.j.f()) {
                this.i.c();
            }
            C7471uYa.a((Object) execute, "response");
            a(execute);
            int d2 = execute.d();
            Cyb a2 = execute.a();
            if (a2 != null) {
                C7233qyb contentType = a2.contentType();
                Cyb a3 = execute.a();
                if (a3 != null) {
                    return new jfa(hfa, d2, contentType, a3.bytes());
                }
                C7471uYa.a();
                throw null;
            }
            C7471uYa.a();
            throw null;
        } catch (IOException e2) {
            return new jfa(ifa.a(hfa, e2));
        } catch (Lea e3) {
            if (!this.l) {
                return new jfa(ifa.a(hfa, e3));
            }
            throw new IllegalStateException(e3);
        }
    }

    private <T> T b(jfa jfa, C4990IKa<T> iKa) throws IOException, Lea {
        Nea nea = (Nea) this.e.get();
        byte[] c2 = jfa.c();
        C7471uYa.a((Object) c2, "apiResponse.responseBodyBytes");
        T a2 = nea.a(c2, iKa);
        if (a2 != null) {
            return a2;
        }
        throw new Lea("Response could not be deserialized, or types do not match");
    }

    private void a(C7647wyb wyb) {
        b a2 = SDb.a("ApiClient");
        StringBuilder sb = new StringBuilder();
        sb.append("[Req][");
        Thread currentThread = Thread.currentThread();
        C7471uYa.a((Object) currentThread, "Thread.currentThread()");
        sb.append(currentThread.getName());
        sb.append("] ");
        sb.append(wyb.e());
        sb.append(' ');
        sb.append(wyb.g());
        sb.append("; headers = ");
        String nyb = wyb.c().toString();
        C7471uYa.a((Object) nyb, "request.headers().toString()");
        sb.append(new C7162pxb("\\n").a((CharSequence) nyb, " | "));
        a2.a(sb.toString(), new Object[0]);
    }

    private void a(C7647wyb wyb, long j2) {
        if (j.g()) {
            b a2 = SDb.a("ApiClient");
            StringBuilder sb = new StringBuilder();
            sb.append("[Req][");
            Thread currentThread = Thread.currentThread();
            C7471uYa.a((Object) currentThread, "Thread.currentThread()");
            sb.append(currentThread.getName());
            sb.append("] ");
            sb.append(wyb.e());
            sb.append(' ');
            sb.append(wyb.g());
            sb.append("; headers = ");
            String nyb = wyb.c().toString();
            C7471uYa.a((Object) nyb, "request.headers().toString()");
            sb.append(new C7162pxb("\\n").a((CharSequence) nyb, " | "));
            sb.append("; response time = ");
            sb.append(j2);
            a2.f(sb.toString(), new Object[0]);
        }
    }

    private void a(Ayb ayb) {
        b a2 = SDb.a("ApiClient");
        StringBuilder sb = new StringBuilder();
        sb.append("[Rsp][");
        Thread currentThread = Thread.currentThread();
        C7471uYa.a((Object) currentThread, "Thread.currentThread()");
        sb.append(currentThread.getName());
        sb.append("] ");
        sb.append(ayb);
        a2.a(sb.toString(), new Object[0]);
    }

    private void a(hfa hfa, defpackage.C7647wyb.a aVar) {
        aVar.b("Accept", hfa.b());
        aVar.b("User-Agent", this.f.j());
        aVar.b("App-Version", String.valueOf(this.f.b()));
        aVar.b("App-Environment", a());
        aVar.b("App-Locale", this.k.a());
        this.k.b().a((C7733yKa<? super T>) new C3056iP<Object>(aVar));
        if (!hfa.a()) {
            if (this.j.e().e()) {
                aVar.b("Authorization", this.h.a());
            }
            aVar.b("UDID", this.f.i());
            C4928GKa b2 = this.g.b();
            if (b2.c()) {
                aVar.b("ADID", (String) b2.b());
                aVar.b("ADID-TRACKING", String.valueOf(this.g.c()));
            }
            if (this.f.n()) {
                aVar.b("User-Interface-Type", "tablet");
            }
        }
        this.m.a().a((C7733yKa<? super T>) new C3075jP<Object>(aVar));
        Set<Entry> entrySet = this.n.b().entrySet();
        ArrayList arrayList = new ArrayList(C6986nWa.a((Iterable) entrySet, 10));
        for (Entry entry : entrySet) {
            StringBuilder sb = new StringBuilder();
            sb.append((String) entry.getKey());
            sb.append("=");
            sb.append((String) entry.getValue());
            arrayList.add(sb.toString());
        }
        aVar.b("App-Requested-Features", C7676xWa.a(arrayList, ",", null, null, 0, null, null, 62, null));
        Map c2 = hfa.c();
        C7471uYa.a((Object) c2, "request.headers");
        for (Entry entry2 : c2.entrySet()) {
            aVar.b((String) entry2.getKey(), (String) entry2.getValue());
        }
    }

    private C7854zyb a(gfa gfa) throws UnsupportedEncodingException, Lea {
        C7233qyb b2 = C7233qyb.b(gfa.i());
        Nea nea = (Nea) this.e.get();
        Object h2 = gfa.h();
        C7471uYa.a(h2, "request.content");
        String a2 = nea.a(h2);
        String name = C5053KKa.c.name();
        C7471uYa.a((Object) name, "Charsets.UTF_8.name()");
        Charset forName = Charset.forName(name);
        C7471uYa.a((Object) forName, "Charset.forName(charsetName)");
        if (a2 != null) {
            byte[] bytes = a2.getBytes(forName);
            C7471uYa.a((Object) bytes, "(this as java.lang.String).getBytes(charset)");
            C7854zyb a3 = C7854zyb.a(b2, bytes);
            C7471uYa.a((Object) a3, "RequestBody.create(mediaType, content)");
            return a3;
        }
        throw new OVa("null cannot be cast to non-null type java.lang.String");
    }

    private C7854zyb a(ffa ffa) {
        defpackage.C7302ryb.a aVar = new defpackage.C7302ryb.a();
        aVar.a(C7302ryb.e);
        List<lfa> h2 = ffa.h();
        C7471uYa.a((Object) h2, "request.parts");
        for (lfa lfa : h2) {
            if (lfa instanceof nfa) {
                aVar.a(lfa.b(), ((nfa) lfa).c());
            } else if (lfa instanceof kfa) {
                kfa kfa = (kfa) lfa;
                aVar.a(kfa.b(), kfa.d(), C7854zyb.a(C7233qyb.b(lfa.a()), kfa.c()));
            }
        }
        C7302ryb a2 = aVar.a();
        if (ffa.j()) {
            return new C3180oP(a2, ffa.i());
        }
        C7471uYa.a((Object) a2, "multipartBody");
        return a2;
    }

    public <ResourceType> ResourceType a(hfa hfa, C4990IKa<ResourceType> iKa) throws IOException, ifa, Lea {
        C7471uYa.b(hfa, "request");
        C7471uYa.b(iKa, "resourceType");
        try {
            return a(a(hfa), iKa);
        } catch (Lea e2) {
            if (this.l) {
                throw new IllegalStateException(e2);
            }
            throw e2;
        }
    }

    public <ResourceType> ResourceType a(hfa hfa, Class<ResourceType> cls) throws IOException, ifa, Lea {
        C7471uYa.b(hfa, "request");
        C7471uYa.b(cls, "resourceType");
        C4990IKa a2 = C4990IKa.a(cls);
        C7471uYa.a((Object) a2, "TypeToken.of(resourceType)");
        return a(hfa, a2);
    }

    public <T> T a(jfa jfa, C4990IKa<T> iKa) throws IOException, ifa, Lea {
        C7471uYa.b(jfa, "apiResponse");
        C7471uYa.b(iKa, "typeToken");
        if (!jfa.g()) {
            ifa a2 = jfa.a();
            if (a2 == null) {
                C7471uYa.a();
                throw null;
            }
            throw a2;
        } else if (jfa.e()) {
            return b(jfa, iKa);
        } else {
            throw new Lea("Empty response body");
        }
    }
}
